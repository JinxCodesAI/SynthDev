{
    "workflow_name": "coder_reviewer",
    "description": "Workflow suitable to implement medium size features and mitigate AI stopping halfway. Reviewer validates if coder is on track and corrects him if necessary",
    "input": {
        "name": "task_to_do",
        "type": "string",
        "description": "detailed description of a task that needs to be carried over"
    },
    "output": {
        "name": "work_summary",
        "type": "string",
        "description": "Summary of the completed work"
    },
    "variables": {
        "max_iterations": 10
    },
    "contexts": [
        {
            "name": "code_history",
            "starting_messages": [],
            "max_length": 50000
        }
    ],
    "agents": [
        {
            "agent_role": "coder",
            "context": "code_history",
            "role": "assistant"
        },
        {
            "agent_role": "reviewer",
            "context": "code_history",
            "role": "user"
        }
    ],
    "states": [
        {
            "name": "start",
            "action": {
                "script": "common_data.current_task = 'Perform following task: ' + common_data.task_to_do; common_data.review_instruction = 'review coder\\'s work, provide continue_message or work_summary';"
            },
            "transition": [
                {
                    "target": "code",
                    "condition": "true"
                }
            ]
        },
        {
            "name": "code",
            "agent": "coder",
            "input": "common_data.current_task",
            "action": {
                "function": "sendUserMessage"
            },
            "transition": [
                {
                    "target": "code",
                    "condition": "getToolCalls('coder').length > 0"
                },
                {
                    "target": "review",
                    "condition": "true"
                }
            ]
        },
        {
            "name": "review",
            "agent": "reviewer",
            "input": "common_data.review_instruction",
            "action": {
                "function": "sendUserMessage"
            },
            "transition": [
                {
                    "target": "code",
                    "condition": "function.review_work.arguments.improvement_needed === true",
                    "before": "common_data.current_task = function.review_work.arguments.continue_message;"
                },
                {
                    "target": "stop",
                    "condition": "function.review_work.arguments.improvement_needed === false",
                    "before": "common_data.work_summary = function.review_work.arguments.work_summary;"
                }
            ]
        },
        {
            "name": "stop",
            "input": "common_data.work_summary"
        }
    ]
}
